# AI Orchestration Layer — Comprehensive Data Model

This data model defines all key entities used by the AI orchestration layer for managing agent workflows, GitHub interactions, and compliance logging.

---

## 1. Entity Overview

| **Entity** | **Purpose** |
|-------------|-------------|
| **Issue** | Represents a task or feature from GitHub or another backlog source. |
| **AgentJob** | A single execution instance of an AI agent working on a task. |
| **Agent** | Metadata about the AI model or container performing the task. |
| **OrchestratorEvent** | System-level log of key orchestration actions (create, assign, PR open, etc.). |
| **PullRequest** | Represents a PR generated by an AI agent, with full audit trace. |
| **ExecutionLog** | Detailed, time-stamped record of the AI agent’s actions. |
| **CIResult** | Outcome of CI/CD pipeline for a given PR. |
| **ModelVersion** | Metadata describing the AI model used for each run (for compliance). |
| **ComplianceRecord** | Traceable record combining all artifacts for audits. |
| **User** | Human operators or overseers for AI activities. |
| **SystemConfig** | Global orchestration parameters and control flags (e.g. `enable_agents=false`). |

---

## 2. Entity Definitions

### **Issue**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `issue_id` | String (UUID or GitHub ID) | Unique identifier of the issue. |
| `title` | String | Issue title from GitHub. |
| `description` | Text | Detailed issue body / task description. |
| `labels` | Array[String] | GitHub labels (e.g. `AI-Ready`, `P1`). |
| `status` | Enum(`open`, `in_progress`, `completed`, `failed`) | Current state of the issue in orchestration. |
| `priority` | Enum(`P0`, `P1`, `P2`) | Priority level for scheduling. |
| `repository` | String | Repo where issue resides. |
| `created_at` | DateTime | Issue creation timestamp. |
| `updated_at` | DateTime | Last modified time. |
| `assigned_agent_job_id` | String (FK → AgentJob.job_id) | Link to current active agent job. |
| `linked_pr_id` | String (FK → PullRequest.pr_id) | PR generated for this issue. |

---

### **AgentJob**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `job_id` | String (UUID) | Unique job instance ID. |
| `agent_id` | String (FK → Agent.agent_id) | Agent performing the task. |
| `issue_id` | String (FK → Issue.issue_id) | Associated issue. |
| `status` | Enum(`queued`, `running`, `completed`, `failed`, `aborted`) | Execution status. |
| `start_time` | DateTime | When the agent began working. |
| `end_time` | DateTime | When the agent finished or aborted. |
| `branch_name` | String | Git branch used for this job (e.g., `ai-1234`). |
| `container_id` | String | Docker/Kubernetes container reference. |
| `logs_path` | String | File path or URL for `windsurf-output.txt`. |
| `error_message` | Text | If failed, reason or last error output. |
| `attempt_count` | Integer | Number of retries attempted. |

---

### **Agent**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `agent_id` | String (UUID) | Unique agent identifier. |
| `agent_type` | Enum(`coder`, `reviewer`, `tester`, `compliance`) | Role of the agent. |
| `model_name` | String | Model name (e.g., `Windsurf Cascade`, `GPT-4-turbo`). |
| `model_version` | String | Specific model or build version. |
| `container_image` | String | Docker image reference (e.g., `windsurf-agent:1.0`). |
| `memory_enabled` | Boolean | Whether the agent maintains persistent memory. |
| `ruleset_id` | String (FK → ModelVersion.ruleset_id) | Rules or policy applied. |
| `capabilities` | Array[String] | Actions the agent can perform (`edit_code`, `run_tests`, `open_pr`). |
| `created_at` | DateTime | Registration timestamp. |
| `updated_at` | DateTime | Last updated timestamp. |

---

### **OrchestratorEvent**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `event_id` | String (UUID) | Unique event ID. |
| `timestamp` | DateTime | When the event occurred. |
| `event_type` | Enum(`issue_assigned`, `agent_started`, `branch_created`, `pr_opened`, `ci_passed`, `ci_failed`, `agent_failed`, `manual_override`) | Type of orchestrator action. |
| `entity_ref` | String | Reference to related entity (Issue, AgentJob, PR, etc.). |
| `details` | Text | Human-readable event message. |
| `initiated_by` | Enum(`system`, `agent`, `user`) | Who/what triggered the event. |
| `user_id` | String (FK → User.user_id, nullable) | If initiated by a human. |

---

### **PullRequest**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `pr_id` | String (UUID or GitHub PR ID) | Unique pull request identifier. |
| `repository` | String | Repository name. |
| `branch_name` | String | Source branch (from AgentJob). |
| `base_branch` | String | Target branch (e.g., `main`). |
| `title` | String | PR title. |
| `description` | Text | Detailed PR body (AI-generated summary). |
| `status` | Enum(`open`, `merged`, `closed`, `failed_checks`) | Current PR state. |
| `ci_result_id` | String (FK → CIResult.ci_result_id) | Linked CI/CD outcome. |
| `created_at` | DateTime | Time of PR creation. |
| `merged_at` | DateTime | If merged, timestamp. |
| `reviewer_agent_id` | String (FK → Agent.agent_id, nullable) | AI or human reviewer agent. |

---

### **ExecutionLog**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `log_id` | String (UUID) | Unique log entry ID. |
| `job_id` | String (FK → AgentJob.job_id) | Associated job. |
| `timestamp` | DateTime | Time of log entry. |
| `action` | String | Action performed (e.g., “Created UserController.java”). |
| `output_snippet` | Text | Short text output or result. |
| `log_level` | Enum(`info`, `warn`, `error`, `debug`) | Severity level. |
| `source` | Enum(`windsurf`, `orchestrator`, `ci_pipeline`) | Log origin. |

---

### **CIResult**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `ci_result_id` | String (UUID) | Unique identifier for CI/CD run. |
| `pr_id` | String (FK → PullRequest.pr_id) | Related pull request. |
| `status` | Enum(`passed`, `failed`, `pending`) | CI pipeline result. |
| `test_summary` | Text | Summary of test results (e.g., “145 passed, 2 failed”). |
| `artifact_link` | String | Link to build or test artifacts. |
| `duration` | Integer (seconds) | Duration of the CI job. |
| `completed_at` | DateTime | Completion time. |

---

### **ModelVersion**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `model_version_id` | String (UUID) | Unique version identifier. |
| `model_name` | String | AI model used (e.g., `GPT-5`, `Claude 3`, `Windsurf Cascade`). |
| `release_date` | Date | Model release date. |
| `ruleset_id` | String | Reference to security or behavior rules. |
| `training_data_scope` | Text | High-level description of model’s training domain. |
| `retention_policy` | Enum(`no_logging`, `30_days`, `90_days`, `custom`) | Data retention policy. |

---

### **ComplianceRecord**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `record_id` | String (UUID) | Unique record ID. |
| `job_id` | String (FK → AgentJob.job_id) | Linked agent job. |
| `pr_id` | String (FK → PullRequest.pr_id) | Linked PR. |
| `audit_log_uri` | String | Storage location for combined logs and artifacts. |
| `evidence_hash` | String | SHA256 hash for immutability proof. |
| `verified_by` | String (FK → User.user_id) | Human reviewer for compliance check. |
| `status` | Enum(`verified`, `pending`, `non_compliant`) | Verification state. |
| `verified_at` | DateTime | Timestamp when compliance verified. |

---

### **User**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `user_id` | String (UUID) | Unique user identifier. |
| `name` | String | Full name. |
| `role` | Enum(`admin`, `devops`, `reviewer`, `observer`) | User role in system. |
| `email` | String | Contact info. |
| `permissions` | Array[String] | Specific orchestration capabilities. |
| `created_at` | DateTime | Account creation date. |

---

### **SystemConfig**

| **Field** | **Type** | **Description** |
|------------|-----------|----------------|
| `config_id` | String | Configuration key name. |
| `value` | String | Configuration value. |
| `description` | String | Explanation of config. |
| `last_updated` | DateTime | When last modified. |
| `updated_by` | String (FK → User.user_id) | Who made the change. |

**Example Configurations:**
```json
{
  "max_parallel_agents": 5,
  "enable_agents": true,
  "retry_limit": 3,
  "allowed_models": ["Windsurf Cascade", "GPT-4-turbo"],
  "compliance_mode": "strict"
}

**Entity Relationship Diagram (ERD Summary)**
User ─────┬──────────────┐
          │              │
          ▼              ▼
    OrchestratorEvent    ComplianceRecord
          │                   │
          ▼                   │
        AgentJob ───────> PullRequest ─────> CIResult
          │                     │
          ▼                     │
        Issue <──────────────────┘
          │
          ▼
        Agent ───> ModelVersion
